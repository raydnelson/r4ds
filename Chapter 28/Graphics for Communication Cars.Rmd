---
title: "Graphics for Communication: MPG For Almost the Last Time"
author: "MPA 634: Data Science for Managers"
date: "26 Mar 2020"
output: 
  html_document:
    code_folding: "hide"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      message = FALSE,
                      warning = FALSE)
# Load libraries
library(tidyverse)
library(ggrepel)
```  

# Mileage Graph from MPG

## Finished Graph

```{r end product}
best_in_class <- mpg %>%
    group_by(class) %>%
    arrange(desc(hwy)) %>%
    mutate(ranking = row_number()) %>%
    filter(ranking == 1)

mpg %>%
  ggplot(aes(displ, hwy)) +
  geom_point(aes(color = class)) +
  geom_smooth(se = FALSE) +
  geom_point(size = 4, shape = 1, data = best_in_class) +
  theme(legend.position = "bottom") +
  ggrepel::geom_label_repel(data = best_in_class, aes(label = model)) +
  labs(
    title = "Fuel efficiency generally decreases with engine size",
    subtitle = "Two seaters (sports cars) are an exception because of their light weight",
    caption = "Data from fueleconomy.gov",
    x = "Engine displacement (L)",
    y = "Highway fuel economy (mpg)",
    color = "Car type"
  ) 
```

## Step by Step

### First create this graph

```{r basic graph}
(basic_plot <- mpg %>%
  ggplot(aes(displ, hwy)) +
  geom_point(aes(color = class)) +
  geom_smooth(se = FALSE)
)
```

### Now annotate your graph so that it identifies the best car in each class

1.  Create a new tibble called best_in_class by
2.  Grouping by class
3.  Sort observations for each group so that the best mileage is the first observations
4.  Create a new variable called ranking
5.  Choose the observations with the number one ranking in each class.  


```{r find the best cars in each class}
## Best MPG in each car class
best_in_class <- mpg %>%
    group_by(class) %>%
    arrange(desc(hwy)) %>%
    mutate(ranking = row_number()) %>%
    filter(ranking == 1)

best_in_class %>% 
  select(manufacturer, model, hwy, class, ranking)
```

### Put circles around the best cars  

```{r identify the best cars}
(best_cars <- basic_plot +
  geom_point(data = best_in_class,
             size = 3,
             shape = 1)
)
```

### Control the breaks on the y axis

```{r control the breaks on the y-axis}
(y_breaks <- best_cars +
    scale_y_continuous(breaks = seq(15, 40, by = 5))
)
```  

### Legend to the bottom

```{r legend to the bottom}
(new_basic <- y_breaks +
    theme(legend.position = "bottom")
)
```

### Label the best cars in the diagram using geom_text  

```{r use geom_text, message = FALSE}
new_basic +
  geom_text(data = best_in_class, aes(label = model))
```

### Label the best cars in the diagram using geom_label  
```{r use geom_label, message = FALSE}
new_basic +
  geom_label(data = best_in_class, aes(label = model), nudge_y = 2, alpha = 0.5)
```

### Label the best cars in the diagram using geom_label_repel
```{r use geom_label_repel, message = FALSE}
(with_labels <- new_basic +
  ggrepel::geom_label_repel(data = best_in_class, aes(label = model))
)
```

### Add titles and labels

```{r titles and labels}
with_labels +
    labs(
    title = "Fuel efficiency generally decreases with engine size",
    subtitle = "Two seaters (sports cars) are an exception because of their light weight",
    caption = "Data from fueleconomy.gov",
    x = "Engine displacement (L)",
    y = "Highway fuel economy (mpg)",
    color = "Car type"
  ) 
```

