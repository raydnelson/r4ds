---
title: "Conditional Execution"
author: "MPA 634: Data Science for Managers"
date: "9 March 2020"
output:
  html_document:
    code_folding: "hide"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      warning = FALSE,
                      message = FALSE)
# Load libraries
library(tidyverse)
library(nycflights13)
library(conflicted)
conflict_prefer("filter", "dplyr")
conflict_prefer("lag", "dplyr")
```

# Syntax for conditional branching

## Traditional syntax

```{r traditional syntax}
gender <- "female"

if (gender == "female"){
  1
} else{
  0
}
```

## Compact syntax

```{r compact syntax}
if (identical(gender, "female")) 1 else 0
```

# Attendance Quiz

## Basic code

```{r attendance quiz}
random_draw <- runif(n = 1, min = 0, max = 1) 
if (random_draw <= 0.5) "Attendance" else "Regular"
```

## Does this procedure give an appropriate number of attendance quizzes?

```{r attendance quiz fair}
results <- vector("character", 10000)
for (i in 1:10000){
  results[i] <- if (runif(1, min = 0, max = 1) <= 0.5) "Attendance" else "Regular"
}
tibble(results) %>% 
  count(results)
```

# Roll dice to see if we get doubles

## Basic calculation of roll of die

```{r basic die}
runif(n = 1, min = 0, max = 6) %>% ceiling()
``` 

## What is the distribution of 10,000 throws of a die

```{r fair die}
results <- vector("integer", 10000)
for (i in 1:10000){
  results[i] <- runif(n = 1, min = 0, max = 6) %>%
    ceiling()
}
tibble(results) %>% 
  count(results)
```

## Do you roll doubles?

```{r doubles}
outcome1 <- runif(n = 1, min = 0, max = 6) %>% ceiling()
outcome2 <- runif(n = 1, min = 0, max = 6) %>% ceiling()
if (identical(outcome1, outcome2)) {
    "doubles"
  } else {
    "different"
  } 
```

## Does the law of large number work for two dies

```{r fair for doubles}
results <- vector("character", 10000)
for (i in 1:10000){
  outcome1 <- runif(n = 1, min = 0, max = 6) %>% ceiling()
  outcome2 <- runif(1, min = 0, max = 6) %>% ceiling()
  results[i] <- if (identical(outcome1, outcome2)){
    "doubles"
  } else {
    "different"
  } 
}
tibble(results) %>% 
  count(results)
```

## Rock, paper, scissors game  

*  Function to determine rock, paper, or scissors with equal probability
*  Function to compare to players to see who wins
*  Report the results

### Choose rock, paper, or scissors

```{r rock paper or scissors}
choose_object <- function(){
  x <- runif(1)
  if (x < 1/3){
    "rock"
  } else if (x > 2/3){
    "scissors"
  } else {
    "paper"
  }
}
```

### Test the function

```{r test of choice function}
results <- vector("character", 10000)
for (i in 1:10000) {
  results[i] <- choose_object()
}
tibble(results) %>% 
  count(results)
```

### Choose the winner function

```{r winner}
select_winner <- function(person1, person2) {
  if (person1 == "rock"){
    if (person2 == "rock"){
      outcome = "ties"
    } else if (person2 == "paper") {
      outcome = "loses"
    } else {
      outcome = "wins"
    }
  } else if (person1 == "paper") {
      if (person2 == "rock"){
        outcome = "wins"
      } else if (person2 == "paper") {
        outcome = "ties"
      } else {
        outcome = "loses"
      }
  } else {
      if (person2 == "rock"){
        outcome = "loses"
      } else if (person2 == "paper") {
        outcome = "wins"
      } else {
        outcome = "ties"
      }
  }
  paste0("Person 1 ", outcome, ".")
}
```

### Play the game  

*  Choice for person 1
*  Report choice for person 1
*  Choice for person 2
*  Report choice for person 2
*  Declare the winner 

#### Function to play the game

```{r play game function}
play_game <- function() {
  person1 <- choose_object()
  paste0("Person 1 chose: ", person1) %>% print()
  person2 <- choose_object()
  paste0("Person 2 chose: ", person2) %>% print()
  select_winner(person1, person2)
}
```

#### Play the game

```{r play rock paper scissors}
play_game() 
```

# Use cut to create a factor

```{r how to use the cut function}
# Create category
flights$early_late <-
  cut(flights$arr_delay, c(-Inf, -60, 0, 60, +Inf), c("very early",
                                             "early",
                                             "late",
                                             "very late"))
flights %>% 
  count(early_late)
```

# Use switch to execute multiple if else logic

## Switch using a number for position

```{r switch with position}
switch(2, "red", "green", "blue", "yellow")
```

## Switch using a number and a function

```{r function and a number}
switch_colors <- function(x){
  switch(x, "red", "green", "blue", "yellow")
}
switch_colors(3)
```

## Switch using characters

```{r switch using characters}
switch("shape",
       "color" = "red",
       "shape" = "square",
       "length" = 5)
```

## Switch in a string and a function

```{r function and string}
switch_colors <- function(x){
  switch(x,
         "one" = "red",
         "two" = "green",
         "three" = "blue",
         "four" = "yellow")
}
switch_colors("one")
```

# Create a new attendance quiz selector

*  Choose type of quiz
*  Change the probability of the quiz based on number of days since previous attendance quiz

## Necessary components

1. Function that determines the probability of an attendance quiz that takes the number of days since an attendance quiz as an argument.
2. Function that determines attendance or regular quiz which has probability as an argument
3. Function that combines the above two functions to determine the type of quiz

### Choose the probability of an attendance based on number of days since last attendance quiz

```{r probability function of quiz}
probability_attendance <- function(days_since_attendance) {
  if (days_since_attendance == 0) {
    0.30
  } else if (days_since_attendance == 1) {
    0.40
  } else if (days_since_attendance == 2) {
    0.50
  } else if (days_since_attendance == 3) {
    0.60
  } else if (days_since_attendance == 4) {
    0.70
  } else {
    0.80
  }
}
```

### Test the Function

```{r}
probability_attendance(3)
```

### Simplier version of the function

```{r simplier version of the probability function}
probability_attendance <- function(days_since_attendance) {
  if (days_since_attendance > 5) days_since_attendance <- 5
  switch(days_since_attendance + 1,
         0.30,
         0.40,
         0.50,
         0.60,
         0.70,
         0.80)
}
```

### Test the Function

```{r test the new version}
probability_attendance(3)
```

### Attendance or regular quiz function

```{r type of quiz}
choose_quiz <- function(probability_attendance){
  if (runif(1) < probability_attendance) "Attendance" else "Regular"
}
```

### Test the function

```{r test quiz function}
choose_quiz(.6)
```

### Simulation to see if the function is fair

```{r simulation of quiz}
results <- vector()
for (i in 1:10000){
  results[i] <- choose_quiz(.6)
}

tibble(results) %>% 
  count(results)
```

### Function that chooses the quiz

*  Input of days since last attendance
*  Calculates the probability
*  Reports the probability
*  Determines the type of quiz
*  Reports the type of quiz  

```{r attendance quiz function}
attendance_or_regular <- function(days_since_attendance) {
  probability <- probability_attendance(days_since_attendance)
  paste("The probability of an attendance quiz:", probability) %>% print()
  quiz <- choose_quiz(probability)
  paste("Today's quiz is: ", quiz)
}
```

### Test the Function

```{r test the attendance quiz function}
attendance_or_regular(0)
```
