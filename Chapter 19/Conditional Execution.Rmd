---
title: "Conditional Execution"
author: "MPA 634: Data Science for Managers"
date: "4 November 2019"
output:
  html_document:
    code_folding: "hide"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
# Load libraries
library(tidyverse)
library(conflicted)
conflict_prefer("filter", "dplyr")
conflict_prefer("lag", "dplyr")
library(lubridate)
library(nycflights13)
```

## Create a new attendance quiz selector

*  Type of Quiz
*  Probability of Quiz

### Attendance or regular quiz function

```{r type of quiz}
choose_quiz <- function(probability_attendance){
  if (runif(1) < probability_attendance) "Attendance" else "Regular"
}
```
### Test the function

```{r test quiz function}
choose_quiz(.5)
```

### Simulation to see if the function is fair

```{r simulation of quiz}
outcomes <- vector()
for (i in 1:10000){
  outcomes[i] <- choose_quiz(.6)
}

outcomes %>% table()

tibble(number = outcomes) %>% 
  count(number)
```

### Choose the probability of an attendance based on number of days since last attendance quiz

```{r probability function of quiz}
probability_attendance <- function(days_since_attendance) {
  if (days_since_attendance == 0) {
    probability_attendance <- 0.30
  } else if (days_since_attendance == 1) {
    probability_attendance <- 0.40
  } else if (days_since_attendance == 2) {
    probability_attendance <- 0.50
  } else if (days_since_attendance == 3) {
    probability_attendance <- 0.60
  } else if (days_since_attendance == 4) {
    probability_attendance <- 0.70
  } else {
    probability_attendance <- 0.80
  }
  return(probability_attendance)
}
```

### Test the Function

```{r}
probability_attendance(3)
```

### Simplier version of the function

```{r simplier version of the probability function}
probability_attendance <- function(days_since_attendance) {
  if (days_since_attendance > 5)
    days_since_attendance <- 5
  switch(days_since_attendance + 1,
         0.30,
         0.40,
         0.50,
         0.60,
         0.70,
         0.80)
}
```

### Test the Function

```{r test the new version}
probability_attendance(3)
```

### Function that chooses the quiz

*  Input of days since last attendance
*  Calculates the probability
*  Reports the probability
*  Determines the type of quiz
*  Reports the type of quiz  

```{r attendance quiz function}
attendance_or_regular <- function(days_since_attendance) {
  probability <- probability_attendance(days_since_attendance)
  paste("The probability of an attendance quiz:", probability) %>%
    print()
  quiz <- choose_quiz(probability)
  paste("Today's quiz is: ", quiz)
}
```

### Test the Function

```{r test the attendance quiz function}
attendance_or_regular(0)
```

## Rock, paper, scissors game  

*  Function to determine rock, paper, or scissors with equal probability
*  Function to compare to players to see who wins
*  Report the results

### Choose rock, paper, or scissors

```{r rock paper or scissors}
choose_object <- function(){
  x <- runif(1)
  if (x < 1/3){
    game <- "rock"
  } else if (x > 2/3){
    game <- "scissors"
  } else {
    game <- "paper"
  }
}
```

### Test the function

```{r test of choice function}
(person1 <- choose_object()) # for person 1
(person2 <- choose_object())
```

### Choose the winner

```{r winner}
select_winner <- function(person1, person2) {
  if (person1 == "rock"){
    if (person2 == "rock"){
      outcome = "ties"
    } else if (person2 == "paper") {
      outcome = "loses"
    } else {
      outcome = "wins"
    }
  } else if (person1 == "paper") {
      if (person2 == "rock"){
        outcome = "wins"
      } else if (person2 == "paper") {
        outcome = "ties"
      } else {
        outcome = "loses"
      }
  } else {
      if (person2 == "rock"){
        outcome = "loses"
      } else if (person2 == "paper") {
        outcome = "wins"
      } else {
        outcome = "ties"
      }
  }
  paste0("Person 1 ", outcome, ".")
}
```

### Play the game  

*  Choice for person 1
*  Report choice for person 1
*  Choice for person 2
*  Report choice for person 2
*  Declare the winner  

```{r}
play_game <- function() {
  person1 <- choose_object()
  paste0("Person 1 chose: ", person1) %>% print()
  person2 <- choose_object()
  paste0("Person 2 chose: ", person2) %>% print()
  select_winner(person1, person2)
}
```

### Play the game

```{r play rock paper scissors}
play_game() 
```

## Use cut to create a factor

```{r}
# Create category
flights$early_late <-
  cut(flights$arr_delay, c(-Inf, 0,+Inf), c("early", "late"))

# Check the function
flights %>% 
  select(arr_delay, early_late) %>% 
  filter(arr_delay == 0 | arr_delay == 0 | arr_delay == 1) %>% 
  head()

# Calculate the proportion
flights %>%
  filter(!is.na(early_late)) %>%
  summarize(early = mean(early_late == "early") * 100 %>% round(1),
            late = mean(early_late == "late") * 100) %>% round(1)
```


