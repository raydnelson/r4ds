---
title: 'Homework #11 Key'
author: 'Tidy Tibbles'
date: "Due: 2 March 2021"
output:
  html_document:
    code_folding: show
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      message = FALSE,
                      warning = FALSE)
library(tidyverse)
library(readxl)
```

## Concepts

1.  Explain why pivot_longer and pivot_wider are opposite operations.

    The function pivot_longer stacks chosen columns from a wide tibble on top of each other in a new tibble. This function has at least three arguments. The first identifies the columns that we want to stack. The second names a column whose values correspond to the variable names. The third names a column where the values of the variable are stored. Each row in the new long tibble contains the name of the original variable and the original value that corresponds to that variable.

    The function pivot_wider converts a long tibble into one with a wide structure. This function takes two arguments. The first is names_from. This identifies the categorical variable that contains the names of the variables to be converted into columns. The second is values_from gives the column in the long tibble that contains the values for the new columns.

    In summary, the function pivot_longer converts a wide tibble into one with a long structure. The function pivot_wider converts a long tibble into one with a wide structure.

2.  Explain why separate and unite are opposite operations.

    Separate takes one column and splits it into multiple columns. The values in the column to be separated must have either a deliminator or a fixed format with the same number of positions in each value.

    Unite takes multiple columns and concatenates them into a single value.

    In summary, separate splits values into constituent parts and unite combines individual values into a composite.

## Code Interpretation

Interpret the following R code chunk:

```{r code chunk interpretation 1}
who %>% 
  pivot_longer(
    cols = new_sp_m014:newrel_f65,
    names_to = "key",
    values_to = "cases",
    values_drop_na = TRUE
  ) %>% 
  mutate(key = stringr::str_replace(key, "newrel", "new_rel")) %>%
  separate(col = key,
           into = c("new", "type", "sexage")) %>%
  select(-new, -iso2, -iso3) %>% 
  separate(
    col = sexage,
    into = c("sex", "age"),
    sep = 1
  )
```

Line 1: use the who tibble from tidyverse. This tibble gives information about tuberculosis and comes from the World Health Organization.

Lines 2 through 7: takes all of the columns, new_sp_m014 through newrel_f65 and stacks them into two columns. The first column is named key and contains the variable names new_sp_m014 through newrel_f65. The second column contains the values for the variables and is named cases. All missing observations are dropped.

Line 8: replaces all newrel values in the key variable with the value new_rel. This makes the separation in the next step possible.

Lines 9 through 10: Creates three new columns or variables called new, type, and sexage from the column key.

Line 11: Drops the redundant variables iso2 and iso3. It also drops the variable new because it has the same value for each observation.

Lines12 through 16: Accomplishes a second separation by splitting the sexage variable into two new variables: sex and age. The sep = 1 means that sex values come from the first position in the sexage variable and age comes from the remaining positions.

## Write code

Complete the following steps:

1.  Import the excel file interest_rates into R.
2.  Use pivot_longer to create a long tibble.
3.  Draw a time series plot with both interest rates on the same graph. Put date on the x-axis. Put mortgage and treasury on the y-axis.
4.  Use a boxplot to compare the distributions of the 30 year mortgage and 30 year Treasury bonds.

```{r interest rates}
interest_rates <- read_excel("Interest rates.xlsx")

interest_rates_long <- interest_rates %>% 
  pivot_longer(-date,
               names_to = "type",
               values_to = "rate")

interest_rates_long %>% 
  ggplot(aes(x = date, y = rate, color = type)) +
  geom_line()

interest_rates_long  %>%
  ggplot(aes(x = rate, y = type)) +
  geom_boxplot(fill = "lightblue", alpha = 0.5) +
  stat_summary(fun = "mean",
    geom = "point",
    shape = 23,
    size = 1.5,
    fill = "red")

# Without a long tibble, we can also work this problem by using multiple layers for the line plots and the boxplots.

interest_rates %>% 
  ggplot(aes(x = date)) +
  geom_line(aes(y = mortgage), color = "red") +
  geom_line(aes(y = treasury), color = "blue")

# The following construction of the boxplot doesn't allow adding diamonds to depict the mean.

interest_rates %>% 
  ggplot(aes()) +
  geom_boxplot(aes(x = mortgage, y = factor("mortgage")),
               fill = "lightblue", alpha = 0.5) +
  geom_boxplot(aes(x = treasury, y = factor("treasury")),
               fill = "lightblue", alpha = 0.5) +
  labs(
    y = "",
    x = "Rate as a Percentage"
  )
```
