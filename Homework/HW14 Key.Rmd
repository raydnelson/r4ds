---
title: 'Homework #14'
author: 'Dates and Times'
date: "Due: October 30, 2019"
output:
  html_document:
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      warning = FALSE,
                      message = FALSE)
library(tidyverse)
library(lubridate)
library(nycflights13)
```

## Concepts  

1.  Software packages often use a reference date for their date-time functions. Excel uses January 1, 1900. One alternative for R is "Unix Epoch", which is 1970-01-01. Explain how these systems represent date and date-time values as numbers.  

*  Dates are represented as the number of days since January 1, 1970.  

*  Date-times are given as the number of seconds since Janaury 1, 1970.  

2.  Time spans can be measured as durations, periods, or intervals. Compare and contrast these three ways of considering time.

Spans are the difference between two dates.

*  Durations record date-time spans in seconds and date values in days.

*  Period record dates and date-times in "human" times like days, years, and months.  

*  Intervals are stores as the starting and ending time. Make sure that the starting time is first, otherwise we will get a negative value.  

    
## Interpretation of code  

Interpret the following two R code chunks: 

### Code chunk #1  

```{r code chunk interpretation 1}
# Create a Function
make_datetime_100 <- function(year, month, day, time){
  make_datetime(year, month, day, time %/% 100, time %% 100)
}
# Convert departure and arrival times into date-time variables
flights_dt <- flights %>%
  filter(!is.na(dep_time)) %>% 
  mutate(
    dep_time = make_datetime_100(year, month, day, dep_time),
    arr_time = make_datetime_100(year, month, day, arr_time),
    sched_dep_time = make_datetime_100(year, month, day, sched_dep_time),
    sched_arr_time = make_datetime_100(year, month, day, sched_arr_time)
  ) %>% 
  select(origin, dest, ends_with("delay"), ends_with("time"))

flights_dt %>% print()
```  

Line 1 - 3:  Create a function that uses integer division and the modulus function to convert a time in an unorthodox time format into a date-time number.

Lines 5 - 6: Filter the rows of the tibble flights so that we only have non-cancelled flights.  

Lines 7 - 12: Convert four different times into standard date-time format. No new variables are created but rather the previous values are replaced with the converted information.  

Line 13:  Select the variables origin, dest, all those variables that end in "delay", and those that end with "time"  

Line 15: Prints out the resulting tibble  

### Code chunk #2

```{r code chunk interpretation 2}
# Uses the flights_dt from the first code chunk
flights_dt %>% 
  filter(dep_time >= ymd(20131225)) %>%
  filter(dep_time < ymd(20131226)) %>% 
  ggplot(aes(dep_time)) +
  geom_freqpoly(binwidth = 900, color = "blue") +
  labs(
    title = "Flights Departing from New York City",
    subtitle = "Number every 15 minutes on Christmas Day 2013",
    x = "Departure Time",
    y = "Number of Flights"
  )
```  

Line 2: Selects all those flights that departed after the beginning of Christmas Day

Line 3: Selects all those flights that departed before the beginning of the day after Christmas.  

Line 4: Selects departure time as the x variable for ggplot aesthetics.  

Line 5: The variable dep_time is measured in seconds. We want freqpoly to combine the times into 15 second intervals. Therefore, we choose a bandwidth of 60 * 15 to get 900 seconds.  

Lines 6 - 11: Label and title the graph appropriately.

## Write code

Problem 1

1.  Remove the missing observations for dep_time
1.  Select origin, year, month, day, and dep_time from the flights data set
1.  Convert dep_time into a time-date variable using the make_datetime function
1.  Use the hour function to create a new hour variable from the dep_time
1.  Draw a bar chart for the new hour variable
1.  Use faceting to create a chart for each airport

```{r departure hour}
flights %>%
  filter(!is.na(dep_time)) %>% 
  select(origin, year, month, day, dep_time) %>%
  mutate(dep_time = make_datetime(year, month, day, dep_time %/% 100, dep_time %% 100)) %>%
  # mutate(dep_time = make_datetime(year, month, day, dep_time %/% 100)) %>%
  mutate(hour = hour(dep_time)) %>%
  # mutate(hour = dep_time %/% 100) %>% 
  ggplot(aes(hour, fill = origin)) + 
  geom_bar(show.legend = FALSE) +
  facet_grid(rows = vars(origin)) +
  labs(
    title = "Actual Departure Hours",
    subtitle = "New York City Airports during 2013",
    x = "Military Time",
    y = "Number of Flights"
  )
```

Problem 2

Use durations, periods, and intervals to calculate your age today. The functions as.duration, as.period, years, and the %--% operator will be helpful.

```{r age}
# duration
(today() - ymd(19510414)) %>% 
  as.duration()

# period
(today() - ymd(19510414)) %>% 
  as.period() / years(1)
  
# interval
(ymd(19510414) %--% today()) / years(1)
```  



