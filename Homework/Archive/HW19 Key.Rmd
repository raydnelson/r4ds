---
title: "Homework #19 Key"
author: "Simple Models and Model Visualization"
date: "Due: 30 March 2020"
output:
  html_document:
    code_folding: "hide"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      message = FALSE,
                      warning = FALSE)
library(tidyverse)
```

## Concepts  

1.  Explain what you think Hadley Wickham means by the following statement:

> The goal of a model is not to uncover truth, but to discover a simple approximation that is still useful.  

We make models of many things. Maps and globes are simplications of the actual earth. City planners make models of neighborhoods. Architects make models of buildings. Such models are never intended to replicate reality or absolute truth. Rather, the are rudimentary representations that help us understand and forecast real phenomenon. 

2.  Carefully explain what is meant by residuals and how they are related to the idea of explained and unexplained variation.  

Residuals are the difference between actual and predicted values. The predicted values are usually generated by the modeling process. Total variation equals that which is explained plus that which is unexplained. The residuals are the unexplained part of total variation. The variation associated with the model is the pattern that gives us the explained part of the total variation.  
    
## Interpretation of code  

Interpret the following R code chunks: 

Code Chunk #1 Linear Regression

```{r linear regression and prediction}
mpg_lm <- lm(hwy ~ displ, data = mpg)
mpg_lm %>% str()
mpg_lm %>% coefficients()
mpg$displ %>%
  range()
mpg_lm %>%
  predict(newdata = tibble(displ = 5))
```

Line 1: Creates a new object called mpg_lm by running a simple linear regression of hwy mileage on engine displacement. It uses the mpg tibble to complete the estimation. The new object mpg_lm is a list that contains the results of running the simple regression.  

Line 2: Because mpg_lm is a list, we can see the structure of the list using the str() function.  

Line 3: Extracts the parameter estimates for the slope and intercept from the mpg_lm object.  

Lines 4 - 5: Calculates the smallest and largest values for the variable displ (displacement) in the mpg tibble.  

Lines 6 - 7: Takes the model inherent in mpg_lm and uses the estimated equation to predict the highway miles per gallon for a vehicle which has an engine displacement of 5 liters.

Code Chunk #2 Loess model

```{r loess model}
mpg_loess <- loess(hwy ~ displ, data = mpg)
fitted_values <- mpg_loess %>%
  fitted()
studentized_residuals <- mpg_loess %>%
  residuals() %>% 
  scale() %>% 
  as.numeric()
tibble(fitted_values, studentized_residuals) %>% 
  ggplot(aes(fitted_values, studentized_residuals)) +
  geom_point() +
  geom_smooth()
tibble(studentized_residuals) %>% 
  filter(studentized_residuals < -3 | studentized_residuals > 3)
```  

Line 1:  Creates a new object which is a list. The list contains information about a model from the loess family. This locally weighted scatterplot smoothing model has hwy as a response variable and displ as the explanatory variable. The data once again comes from the mpg tibble.  

Lines 2 - 3: Extracts the fitted or predicted values from the mpg_loess model object.  

Lines 4 - 7: Calculates the studentized residuals. The first step gets the residuals from the mpg_loess model object, then subtracts the mean of the residuals and finally divides by the standard deviation or standard error to get the standardized or studentized residuals. In the last line the studentrized residuals are converted into numerical atomic vectors.

Line 8: Creates a tibble whose columns are the predicted and residuals values.  

Lines 9 - 11: Creates a smoothed scatterplot from the tibble created in line 8. The scatterplot has the predicted value on the x-axis and the residuals on the y-axis. The points of the scatterplot come from geom_point and the smoothed loess line comes from geom_smooth.  

Line 12: Creates a tibble of the studentized residuals.

Line 13: Chooses those observations from the tibble created in line 12 that are less than -3 and greater than 3. These are potential outliers.  

## Write Code

Use the mtcars data frame to complete the following:

1.  Create an lm object called mtcars_lm that is the result of estimating a simple regression model of mpg on disp.
1.  Create a new vector called fitted_values by extracting the fitted values from mtcars_lm.
1.  Create a new vector called residuals_lm by finding the residuals in mtcars_lm.
1.  Create a new vector called studentized_residuals by turning residuals_lm  into z-scores.
1.  Create a tibble with fitted_values and studentized_residuals and then plot the studentized residuals on the fitted values. Smooth the scatterplot using loess.
1.  Create a tibble of studentized_residuals and then filter that tibble to find any studentized residuals that are outside the -2 thru +2 range.


```{r type of variables in flights}
mtcars_lm <- lm(mpg ~ disp, data = mtcars)
fitted_values <- mtcars_lm %>% 
  fitted()
residuals_lm <- mtcars_lm %>% 
  residuals()
studentized_residuals <- residuals_lm %>% 
  scale() %>% 
  as.numeric()
tibble(fitted_values, studentized_residuals) %>% 
  ggplot(aes(fitted_values, studentized_residuals)) +
  geom_point() +
  geom_smooth()
tibble(studentized_residuals) %>% 
  filter(studentized_residuals < -2 | studentized_residuals > 2)
```