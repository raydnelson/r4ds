---
title: 'Homework #18 Key'
author: "Time Series"
date: "Due: 1 April 2021"
output:
  html_document:
    code_folding: hide
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      warning = FALSE,
                      message = FALSE)
library(tidyverse)
library(feasts)
library(fable)
load(url("http://govfinance.byu.edu/govfinance/classes/dataViz/homework/HW10.RData"))
```

## Concepts

Smoothing is a very important concept for data visualization. Explain how smoothing is affected in the following cases:

1.  binwidth and number of bins on histograms and freqpoly

Smooth histograms and frequency polygons result when you have a small number of wide bins.

2.  bandwidth (bw) on densities and violin plots

Increasing the bandwidth increases the number points that are averaged. More points in an average gives smoother graphs. The larger number of points means that each one receives a smaller weight in the averaging process.

3.  span on loess smoothed lines

Increasing the span increases the number points that are averaged. More points in an average gives smoother graphs. The larger number of points means that each one receives a smaller weight in the averaging process.

## Code Interpretation

Problem 1: Time series plot

```{r time series plot for ecommerce}
ecommerce %>%
  ggplot(aes(x = as.Date(date), y = ecommerce / 1000)) + 
  geom_point() + 
  geom_smooth(span = 0.3) +
  labs(title = "E-Commerce sales are growing exponentially",
       x = "",
       y = "Billions of Dollars")
```

Line 2: Put the date on the x-axis and the variable ecommerce on the y-axis. Scale the ecommerce data by dividing by 1000. The as.Date function helps ggplot know how to format the labels on the x or time axis. Dividing by 1000 turns the scale of the y-axis from millions of dollars to billions of dollars.

Line 3: Draw a scatterplot using each x and y coordinate pair specified in the aesthetics

Line 4: Look for a trend in the data using loess. Smoothing creates a line that represents the trends in the data. The span = 0.3 means that 30% of the data are used in the locally weighted scatterplot smoothing process. This process opens a window around each point. It estimates a smoothed value for each observations. The smooth is also accompanied by a confidence interval since se = TRUE by default. Choosing the span can often be very subjective.

Lines 5 - 7: Adds labels to the graph. It is especially important to give the units of measure for the y-axis.

Problem 2: STL decomposition

```{r stl decomposition}
ecommerce %>% 
  model(
    STL(ecommerce)
  ) %>% 
  components() %>% 
  autoplot()
  
```

Lines 2 - 4: Fits a seasonal with trend using loess (STL) model to the time series.

Line 5: Extracts the trend, season, and irregular (remainder) components from the STL model

Line 6: Graphs the original data, trend, season, and irregular components using ggplot

Problem 3: ETS forecast

```{r ets forecast}
ecommerce %>% 
  model(
    ETS(ecommerce)
  ) %>% 
  forecast(h = 24) %>% 
  autoplot(ecommerce)
```

Lines 2 - 4: Fits a exponential smoothing error, trend, and seasonality (ETS) model to the time series

Line 5: Uses the ETS model to create forecasts

Line 6: Graphs the original data and the forecasts, along with their confidence intervals, using ggplot

## Coding

Problem 1

Make a time series plot of Salt Lake City housing prices.

```{r problem 1}
slc %>% 
  autoplot()
```

Problem 2

Use STL to look for the trend and seasonality SLC housing prices

```{r problem 2}
slc %>% 
  model(
    STL()
  ) %>% 
  components() %>% 
  autoplot()
```

Problem 3

Forecast SLC housing prices for the next two years

```{r problem 3}
slc %>% 
  model(
    ETS()
  ) %>% 
  forecast(h = 24) %>% 
  autoplot(slc)
```
