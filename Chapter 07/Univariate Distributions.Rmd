---
title: "Univariate Distributions"
author: "MPA 634: Data Science for Managers"
date: "4 Feb 2021"
output:
  html_document:
    code_folding: hide
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      messages = FALSE,
                      warning = FALSE)
library(tidyverse)
data(diamonds)
View(diamonds)
```

## [Exploratory Data Analysis](https://r4ds.had.co.nz/explore-intro.html)

1.  Formulate questions about your data
2.  Investigate answers to questions by visualizing, transforming, and [modeling](https://www.tidymodels.org/)
3.  Evolve and spawn new questions based on what is learned

Data cleaning and [wrangling](https://r4ds.had.co.nz/wrangle-intro.html) also involves visualization, transformation, and modeling.

## Questions

"The key to asking quality questions is to generate a large quantity of questions."

Two types of questions:

1.  How is a variable distributed?
2.  How are variables related to each other?

### Basic definitions

-   Variable: quantity, quality, or property
-   Value: state or level of a variable when it is measured
-   Observation: "a set of measurements under similar conditions"
-   Tabular data: "a set of values, each associated with a variable and an observation."

## Distribution

-   Possible values
-   Frequency or probability of observing values

## Visualizing distributions of categorical variables

### Bar chart for cut using geom_bar

```{r vertical bar chart of cut}
diamonds %>% 
  ggplot(aes(x = cut, fill = cut)) +
  geom_bar(show.legend = FALSE) +
  scale_fill_brewer(palette = "Pastel1")
```

### Horizontal bar chart of cut using count and geom_col

```{r horizontal bar chart of cut}
diamonds %>% 
  count(cut) %>% 
  ggplot(aes(y = cut, x = n, fill = cut)) +
  geom_col(show.legend = FALSE)  +
  scale_fill_brewer(palette = "Pastel1")
```

### Pie chart of cut

#### Start with a stacked bar chart with one category on the x-axis

```{r stacked bar chart before polar coordinates}
diamonds %>% 
  count(cut) %>% 
  ggplot(aes(x = factor(0), y = n, fill = cut)) +
  geom_col(position = "fill")  +
  scale_fill_brewer(palette = "Pastel1")  +
  theme(
    axis.title.x = element_blank(),
    axis.text.x = element_blank(),
    axis.ticks.x = element_blank(),
    axis.title.y = element_blank(),
    axis.text.y = element_blank(),
    axis.ticks.y = element_blank()
  )
```

#### Pie chart by changing the coordinate system to polar.

```{r pie chart}
diamonds %>% 
  count(cut) %>% 
  ggplot(aes(x = factor(0), y = n, fill = cut)) +
  geom_col(position = "fill") +
  coord_polar(theta = "y", start = 0) +
  scale_fill_brewer(palette = "Pastel1") +
  theme(
    axis.title.x = element_blank(),
    axis.text.x = element_blank(),
    axis.ticks.x = element_blank(),
    axis.title.y = element_blank(),
    axis.text.y = element_blank(),
    axis.ticks.y = element_blank()
  )
```

## Visualizing the distribution of a numerical variable

## Characteristics of a Numerical Distribution

Describing the distribution gives us a basic set of questions to start asking. These in turn provoke additional questions. When considering a distribution, we should organize our preliminary investigation around:

1.  **Location (center)**

    measures: median and mean

2.  **Scale (spread)**

    measures: Interquartile Range (IQR) and standard deviation

3.  **Symmetry (symmetrical, right skewed, or left skewed)**

    measure: skewness coefficient

4.  **Outliers (tail thickness)**

    measure: kurtosis or coefficient of excess

### Histogram of carat

```{r histogram of carat}
diamonds %>%
  ggplot(aes(x = carat)) +
  geom_histogram(binwidth = 0.5, fill = "lightblue")
```

### Density of carat

We can control the amount of smoothing by using the bw argument to geom_density.

```{r density of carat}
diamonds %>%
  ggplot(aes(x = carat)) +
  geom_density(fill = "lightblue")
```

We can add tick marks for each observation by using the geom_rug. In order to keep the calculations to a reasonable level, we take a sample of 1,000 observations from the original diamonds data frame.

```{r density of carat with rug ticks}
diamonds_sub <- diamonds %>%
  sample_n(1000)
diamonds_sub %>% 
  ggplot(aes(x = carat)) +
  geom_density(fill = "lightblue") +
  geom_rug()
```

Violin plot mirrors the density

```{r violin plot as a mirror}
diamonds_sub %>%
  ggplot(aes(x = carat, y = factor(0))) +
  geom_violin(fill = "lightblue") +
  geom_rug()
```

### Location or central tendency of the distribution is measured by the mean and the median

```{r location or central tendency}
mean(diamonds$carat)
median(diamonds$carat)
diamonds %>%
  ggplot(aes(x = carat)) +
  geom_density(fill = "lightblue") +
  geom_vline(
    xintercept = mean(diamonds$carat),
    color = "red",
    size = 2
  ) +
  geom_vline(
    xintercept = median(diamonds$carat),
    color = "blue",
    size = 2
  )
```

### Scale or spread of carats as measured by standard deviation

```{r scale of diamond size}
carat_mean <- mean(diamonds$carat)
carat_sd <- sd(diamonds$carat)
diamonds %>% 
  ggplot(aes(x = carat)) +
  geom_density(fill = "lightblue", bw = 0.2) +
  geom_vline(xintercept = carat_mean, color = "red") +
  geom_vline(xintercept = carat_mean - carat_sd, color = "blue", size = 2) +
  geom_vline(xintercept = carat_mean + carat_sd, color = "blue", size = 2)
```

### Tukey's five number summary

1.  Minimum
2.  First Quartile
3.  Second Quartile
4.  Third Quartile
5.  Maximum

The quantile and summary functions give us these values.

```{r quantiles}
quantile(diamonds$carat)
summary(diamonds$carat)
```

![](http://govfinance.byu.edu/govfinance/classes/dataScience/lectures/images/Turkeys5number.jpg "Tukey's Five Number Summary"){width="600"}

Special thanks to Rachel Brown for this creative and memorable learning aid.

## Boxplots graph Tukey's five number summary.

1.  The line within the rectangle is the median.
2.  The length of the box is determined by the first and third quartiles or the interquartile range.
3.  The maximum and the minimum are either ends of the whiskers or outliers.

## Location and scale of a distribution from a boxplot

1.  The median gives the location
2.  Scale is the IQR or length of the box. This is the difference between the third and first quartiles.

### Boxplot of diamond size

```{r boxplot of carat}
diamonds %>% 
  ggplot(aes(y = factor("Size"), x = carat)) +
  geom_boxplot() +
  stat_summary(fun = "mean",
             geom = "point",
             shape = 23,
             size = 1.5,
             fill = "red")
```

### Components of the box in the boxplot

```{r box of boxplot}
Median <- median(diamonds$carat)
lower_hinge <- quantile(diamonds$carat, 0.25)
upper_hinge <- quantile(diamonds$carat, 0.75)

diamonds %>% 
  ggplot(aes(y = factor("Size"), x = carat)) +
  geom_vline(xintercept = Median, color = "red") +
  geom_vline(xintercept = lower_hinge, color = "blue") +
  geom_vline(xintercept = upper_hinge, color = "blue") +
  geom_boxplot(fill = "lightgreen") +
  stat_summary(fun = "mean",
             geom = "point",
             shape = 23,
             size = 1.5,
             fill = "red")
```

### Interquartile range

The length of the box in the boxplot is called the interquartile range. It is the third quartile minus the first quartile.

```{r interquartile range}
upper_hinge - lower_hinge
IQR(diamonds$carat)
```

### Boxplot whiskers and outliers

The lower whisker of a boxplot starts at the lower hinge. We then move left 1.5 \* IQR and then slide right towards the hinge until we encounter an observation.

The upper whisker of a boxplot starts at the upper hinge. We then move right 1.5 \* IQR and then slide left towards the hinge until we encounter an observation.

Outliers are those observations that lie more than 1.5 \* IQR from the lower and upper hinges.

## Symmetry is assessed by:

1.  Relationship of the mean and the median
2.  Comparison of the left and right whiskers
3.  Position of the median relative to the hinges of the box
4.  Balance of left and right outliers

### Consider now the four dimensions of the diamond size distribution:

1.  Location
2.  Scale
3.  Symmetry
4.  Outliers

```{r boxplot interpretation}
diamonds %>% 
  ggplot(aes(y = factor("Size"), x = carat)) +
  geom_boxplot(fill = "lightblue") +
  stat_summary(fun = "mean",
             geom = "point",
             shape = 23,
             size = 1.5,
             fill = "red")
```

### Now combine the density with the boxplot to get a violin plot

```{r violin plot}
diamonds %>% 
  ggplot(aes(y = factor("Size"), x = carat)) +
  geom_violin(fill = "lightgreen") +
  geom_boxplot(fill = "lightblue", width = 0.1) +
  stat_summary(fun = "mean",
             geom = "point",
             shape = 23,
             size = 1.5,
             fill = "red")
```

### Compare highway and city mileage using a boxplot

```{r highway and city mileage}
mpg %>% 
  ggplot() +
  geom_boxplot(aes(x = hwy, y = factor("Highway")), fill = "blue", alpha = 0.25) +
  geom_boxplot(aes(x = cty, y = factor("City")), fill = "red", alpha = 0.25) +
  labs(
    title = "Vehicles get better mileage on the highway.",
    subtitle = "1999 and 2008 Vehicles",
    x = "Miles Per Gallon",
    y = "",
    caption = "Source: Tidyverse mpg"
  )
```
