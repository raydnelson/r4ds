---
title: "Covariation"
author: "MPA 634: Data Science for Managers"
date: "5 Feb 2020"
output:
  html_document:
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      message = FALSE,
                      warning = FALSE)
library(tidyverse)
```

## Explore the car highway mileage
### Distribution of mileage

1.  Location
1.  Scale
1.  Symmetry
1.  Outliers

```{r distribution of highway mileage}
summary(mpg$hwy)
sd(mpg$hwy)
IQR(mpg$hwy)
mpg %>%
  ggplot(aes(x = hwy)) +
  geom_density(fill = "lightblue")
```

### Distribution of class of car

```{r distribution of class of car}
mpg %>%
  ggplot(aes(x = fct_infreq(class), fill = class)) +
  geom_bar(show.legend = FALSE) +
  labs(
    title = "There are more SUV's than other vehicle classes.",
    x = "Vehicle Class",
    y = "Number of Vehicles"
  ) +
  scale_fill_brewer(palette = "Set2")
```

## Relationship between categorical and continuous variables

### Distribution of highway miles per gallon by vehicle class using violin plots

```{r distribution of hwy by vehicle class}
mpg %>%
  ggplot(aes(x = fct_reorder(class, hwy, median), y = hwy)) +
  geom_violin(fill = "lightgreen") +
  geom_boxplot(width = 0.1, fill = "lightblue") +
  stat_summary(fun.y = "mean",
  geom = "point",
  shape = 18,
  size = 1.5) 
  labs(title = "Violin Plot of Mileage",
       x = "Class of Vehicle",
       y = "Miles Per Gallon") +
  coord_flip()
```

## Relationship between two categorical variables

### Contingency table for diamond color and cut using dplyr and tidyr

```{r contingency}
# Contingency table for diamond color and cut using dplyr and tidyr
diamonds %>% 
  count(color, cut) %>% 
  spread(key = cut, value = n)
```

### geom_point with position jitter

```{r geom_point}
diamonds %>%
  ggplot(aes(x = cut, y = color, color = clarity)) +
  geom_point(position = "jitter",
             alpha = 0.8,
             shape = 16,
             size = 0.5)
```

### geom_count

```{r geom_count}
diamonds %>%
  ggplot(aes(x = cut, y = color)) +
  geom_count()
```

### geom_tile

```{r geom_tile}
diamonds %>% 
  count(color, cut) %>% 
  ggplot(aes(x = cut, y = color)) +
    geom_tile(aes(fill = n))
```

### Bar chart

```{r bar chart}
diamonds %>% 
  ggplot(aes(x = color, fill = cut, width = color)) +
  geom_bar(position = "fill")
```

### Mosaic chart

```{r mosaic}
library(ggmosaic)
diamonds %>% 
  ggplot() +
  geom_mosaic(aes(x = product(color, cut), fill = color), na.rm = TRUE)
```

## Relationship between two continuous variables

### Scatterplot of price on carat

```{r scatterplot of carat and price}
cov(diamonds$carat, diamonds$price)
cor(diamonds$carat, diamonds$price)
diamonds %>%
  ggplot(aes(x = carat, y = price)) +
  geom_point(alpha = 1)
```

### Two dimensional density

### Choose a subset of diamonds

```{r smaller diamonds}
set.seed(1234)
dsmall <- diamonds %>%
  sample_n(1000)
```

### Scatterplot of price on carat for a subset of diamonds

```{r two dimensional density}
dsmall %>%
  ggplot(aes(x = carat, y = price)) +
  geom_point()

dsmall %>%
  ggplot(aes(x = carat, y= price)) +
  stat_density_2d(geom = "raster",
                  aes(fill = stat(density)),
                  contour = FALSE)
```

## Fixing heteroskedasticity with logarithmic transformation

### Heteroskedasticity

```{r heteroskedasticity}
diamonds %>%
  filter(carat < 3) %>% 
  ggplot(aes(x = carat, y = price)) +
  geom_point(alpha = 1 / 100) +
  geom_smooth(color = "blue") + 
  geom_smooth(method = "lm", color = "red")
```

### Logarithmic Transformation

```{r logarithmic transformation}
diamonds %>%
  filter(carat < 3) %>% 
  ggplot(aes(x = log(carat), y = log(price))) +
  geom_point(alpha = 1 / 100) +
  geom_smooth(color = "blue") + 
  geom_smooth(method = "lm", color = "red")
```

## Explore the Old Faithful data frame

### Density for eruption length
```{r density for eruption length}
faithful %>%
  ggplot(aes(x = eruptions)) +
  geom_density(fill = "lightblue")
```

### Density for waiting
```{r density for waiting}
faithful %>%
  ggplot(aes(x = waiting)) +
  geom_density(fill = "lightblue")
```

### Scatterplot for waiting and eruptions  

```{r scatterplot for waiting and eruption length}
faithful %>%
  ggplot(aes(x = waiting, y = eruptions)) +
  geom_point()
```

### Is there a linear pattern in the scatterplot? 

```{r linear pattern}
faithful %>% ggplot(aes(x = waiting, y = eruptions)) +
  geom_point() +
  geom_smooth(method = "lm")
```

### Is there a nonlinear pattern in the scatterplot?

```{r nonlinear pattern}
faithful %>%
ggplot(aes(x = waiting, y = eruptions)) +
  geom_point() +
  geom_smooth() +
  labs(
    title = "Relationship between Old Faithful waiting time and eruption time",
    x = "Waiting Time in Minutes",
    y = "Eruption Duration in Minutes"
  )
```

### Two dimensional density function

```{r two dimensional density for Old Faithful}
faithful %>%
  ggplot(aes(x = waiting, y = eruptions)) +
  stat_density_2d(aes(fill = stat(density)), geom = "raster", contour = FALSE) +
  labs(
    title = "Relationship between Old Faithful waiting time and eruption time",
    x = "Waiting Time in Minutes",
    y = "Eruption Duration in Minutes"
  )
```

