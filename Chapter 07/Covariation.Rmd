---
title: "Covariation"
author: "MPA 634: Data Science for Managers"
date: "10/02/2019"
output:
  html_document:
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      message = FALSE,
                      warning = FALSE)
library(tidyverse)
```

## Explore the Car Highway Mileage
### Distribution of mileage

1.  Location
1.  Scale
1.  Symmetry
1.  Outliers

```{r distribution of highway mileage}
summary(mpg$hwy)
sd(mpg$hwy)
IQR(mpg$hwy)
mpg %>%
  ggplot(aes(x = hwy)) +
  geom_density(fill = "lightblue")
```

### Distribution of class of car

```{r distribution of class of car}
mpg %>%
  ggplot(aes(x = class, fill = class)) +
  geom_bar(show.legend = FALSE)
```

## Relationship between categorical and continous variables

### Distribution of highway miles per gallon by vehicle class using violin plots

```{r distribution of hwy by vehicle class}
mpg %>%
  ggplot(aes(x = reorder(class, hwy, FUN = median), y = hwy)) +
  geom_violin(fill = "lightgreen") +
  geom_boxplot(width = 0.1, fill = "lightblue") +
  labs(title = "Violin Plot of Mileage",
       x = "Class of Vehicle",
       y = "Miles Per Gallon") +
  coord_flip()
```

## Relationship between two categorical variables

```{r categorical variables}
diamonds %>%
  ggplot(aes(x = cut, y = color)) +
  geom_point(position = "jitter",
             alpha = 0.8,
             shape = 16,
             size = 0.5)

diamonds %>%
  ggplot(aes(x = cut, y = color)) +
  geom_count()

diamonds %>% 
  count(color, cut) %>% 
  ggplot(aes(x = cut, y = color)) +
    geom_tile(aes(fill = n))
```

## Relationship between two continuous variables

### Scatterplot

```{r scatterplot of carat and price}
cov(diamonds$carat, diamonds$price)
cor(diamonds$carat, diamonds$price)
diamonds %>%
  ggplot(aes(x = carat, y = price)) +
  geom_point(alpha = 1)
```

### Two Dimensional Density

#### Choose a subset of diamonds

```{r smaller diamonds}
set.seed(4393)
dsmall <- diamonds %>%
  sample_n(1000)
```

#### Scatterplot of price on carat

```{r two dimensional density}
dsmall %>%
  ggplot(aes(x = carat, y = price)) +
  geom_point()

dsmall %>%
  ggplot(aes(x, y)) +
  stat_density_2d(geom = "raster",
                  aes(fill = stat(density)),
                  contour = FALSE)
```

## Fixing heteroskedasticity with logarithmic transformation

### Heteroskedasticity

```{r non constant variance}
diamonds %>%
  filter(carat < 3) %>% 
  ggplot(aes(x = carat, y = price)) +
  geom_point(alpha = 1 / 100) +
  geom_smooth(color = "blue") + 
  geom_smooth(method = "lm", color = "red")
```
### Logarithmic Transformation

```{r logarithmic transformation}
diamonds %>%
  filter(carat < 3) %>% 
  ggplot(aes(x = log(carat), y = log(price))) +
  geom_point(alpha = 1 / 100) +
  geom_smooth(color = "blue") + 
  geom_smooth(method = "lm", color = "red")
```

## Explore the Old Faithful data frame
### Density for eruption length
```{r density for eruption length}
faithful %>%
  ggplot(aes(x = eruptions)) +
  geom_density(fill = "lightblue")
```

### Density for waiting
```{r density for waiting}
faithful %>%
  ggplot(aes(x = waiting)) +
  geom_density(fill = "lightblue")
```

### Scatterplot for waiting and eruptions  

```{r scatterplot for waiting and eruption length}
faithful %>%
  ggplot(aes(x = waiting, y = eruptions)) +
  geom_point()
```

### Is there a linear pattern in the scatterplot? 

```{r linear pattern}
faithful %>% ggplot(aes(x = waiting, y = eruptions)) +
  geom_point() +
  geom_smooth(method = "lm")
```

### Is there a nonlinear pattern in the scatterplot?

```{r nonlinear pattern}
faithful %>%
ggplot(aes(x = waiting, y = eruptions)) +
  geom_point() +
  geom_smooth() +
  labs(
    title = "Relationship between Old Faithful waiting time and eruption time",
    x = "Waiting Time in Minutes",
    y = "Eruption Duration in Minutes"
  )
```

### Two dimensional density function

```{r two dimensional density for Old Faithful}
faithful %>%
  ggplot(aes(x = waiting, y = eruptions)) +
  stat_density_2d(aes(fill = stat(density)), geom = "raster", contour = FALSE) +
  labs(
    title = "Relationship between Old Faithful waiting time and eruption time",
    x = "Waiting Time in Minutes",
    y = "Eruption Duration in Minutes"
  )
```

