---
title: "Midterm I Fall 2019"
author: "Stan Harrison"
date: "10/12/2019"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(nycflights13)
library(knitr)
library(tidyverse)
```

## Problem 1

* Chooses only those observations that fly to either Atlanta (ATL) or Boston (BOS)
* Chooses the flights that are within 30 minutes of the scheduled arrival
* Draws a set of horizontal violin plots for each airport with a separate graph for each destination.
* It is not required that your graph replicate the graph labels. We will cover that in Chapter 28.


```{r Problem 1}
flights %>% 
  select(origin, dest, arr_delay) %>% 
  filter(dest %in% c("ATL", "BOS")) %>% 
  filter(origin %in% c("LGA", "JFK", "EWR")) %>% 
  filter(!is.na(arr_delay)) %>% 
  filter(arr_delay <= 30) %>% 
  filter(arr_delay >= -30) %>% 
  group_by(origin, dest, arr_delay) %>% 
  ggplot(aes(x = origin, y = arr_delay, fill = origin)) +
  geom_violin(show.legend = FALSE) + 
  geom_boxplot(width = 0.2, show.legend = FALSE, fill = "grey") + 
  facet_grid(rows = vars(dest)) + 
  coord_flip() +
  labs(title = "First Coding Problem:", 
       subtitle = "NYC 2013 Flights Within 30 Minutes of Scheduled Arrival", 
       x = "Origin", y = "Arrival Delay")
```

## Problem 2

Please write code that completes the following:

*	Choose only non-cancelled flights that left early
*	Based on the flights that left early, calculate the percentage of those that arrived on time at the destination for each origin airport
*	Draw a bar chart of the percentage for each airport
*	Color the bars by the origin airport
*	Order the bars in the bar chart from highest percentage at the left to lowest percentage at the right
*	It is not required that your graph replicate the graph labels.

```{r Problem 2}
not_cancelled_early <- flights %>% 
  filter(!is.na(dep_delay), !is.na(arr_delay)) %>% 
  filter(dep_delay < 0)

View(not_cancelled_early)

perc_on_time <- not_cancelled_early %>% 
  filter(origin %in% c("EWR", "JFK", "LGA")) %>%
  mutate(on_time = arr_delay > 0) %>% 
  select(origin, dep_delay, arr_delay, on_time) %>% 
  arrange(desc(dep_delay)) %>% 
  group_by(origin, on_time) %>% 
  summarise(n = n())

total <- c(59144, 59144, 61025, 61025, 62966, 62966)

wow <- perc_on_time %>% add_column(total)

View(wow)

almost_done <- wow %>% 
  filter(on_time == FALSE) %>% 
  mutate(percent = n / total)

View(almost_done)

almost_done %>% 
 ggplot(aes(x = origin, y = percent, fill = origin)) + 
    geom_col(show.legend = FALSE) + 
    scale_y_continuous(labels = scales::percent) + 
    labs(title = "Second Coding Problem:", 
        subtitle = "Bar Chart (Pareto) of Percentage On Time", 
        x = "", y = "Percentage")
```

Boy did I take my time figuring this one out. 


