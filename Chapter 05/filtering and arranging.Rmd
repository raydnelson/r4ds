---
title: "Filtering and Arranging"
author: "MPA 634: Data Science for Managers"
date: "26 Jan 2021"
output:
  html_document:
    code_folding: hide
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      message = FALSE,
                      warning = FALSE)
library(tidyverse)
library(nycflights13)
```

The include = FALSE option is used so that we don't see the code or the output from this operation in our document.


### Investigate the flights dataset so become acquainted with the variables. The following are ways to become familiar with a dataset:
*  data() puts the dataset into the environment
*  colnames() lists the names of the variables
*  glimpse() gives an overview
*  summary() gives a summary of each variable
*  View() opens the dataset in a window
*  Typing in the name prints out the data
*  head() gives the first 10 observations
*  tail() gives the last 10 observations

```{r flights dataset}
data(flights)
glimpse(flights)
summary(flights)
head(flights)
tail(flights)
```  

### Use a boxplot to compare the departure delays for the three different airports for New Years Day flights 

```{r New Years departure delays}
flights %>%
  filter(month == 1, day == 1) %>%
  ggplot(aes(y = origin, x = dep_delay)) +
  geom_boxplot(fill = "lightgreen")
```  

### Modify the above plot so that it excludes very long delays (those over an hour).  

```{r exclude New Years outliers}
flights %>%
  filter(month == 1, day == 1, dep_delay <= 60) %>%
  ggplot(aes(x = origin, y = dep_delay)) +
  geom_boxplot(fill = "lightgreen") +
  coord_flip()
```  

### Number of departure delays for Christmas or New Years of less than an hour by New York Airport  

```{r holiday depature delays}
flights %>%
  filter((month == 1 & day == 1) | (month == 12 & day == 25)) %>% 
  filter(dep_delay < 60) %>% 
  ggplot(aes(y = origin, x = dep_delay)) +
  geom_boxplot(fill = "lightgreen")
```  

### Total spring departures (spring is defined as March, April, and May)

```{r spring}
flights %>%
  filter(month %in% 3:5) %>%
  ggplot(aes(x = origin, fill = as.factor(month))) +
  geom_bar(position = "dodge")
```  

### Distribution of arrival delays for flights going to Atlanta (ATL), Los Angeles (LAX), and Chicago (ORD) which have an arrival delay of less than 2 hours 

```{r destinations}
# First create a new data frame with Atlanta, LA, and Chicago
three_airports <- flights %>%
  filter(dest %in% c("ATL", "LAX", "ORD")) %>% 
  filter(arr_delay < 120)

# Density plot
three_airports %>%
  ggplot(aes(x = arr_delay)) +
  geom_density(aes(fill = dest), show.legend = FALSE) +
  geom_vline(xintercept = 0) +
  facet_grid(rows = vars(dest))

# Boxplot
three_airports %>%
  ggplot(aes(y = dest, x = arr_delay)) +
  geom_boxplot(fill = "lightgreen")
```  

### Distribution of arrival delays of less than an hour for American (AA), Delta (DL), and United (UA) flights that left on time

```{r on time departure arrival delays}
flights %>%
  filter(dep_delay <= 0) %>% 
  filter(carrier %in% c("AA", "UA", "DL")) %>% 
  filter(arr_delay < 60) %>% 
  ggplot(aes(y = carrier, x = arr_delay, fill = carrier)) +
  geom_boxplot(fill = "lightblue") +
  geom_vline(xintercept = 0, color = "red")
```  

### Find the flights that were delayed by at least an hour but made up over 30 minutes in flight

```{r made up over 30 minutes in flight}
flights %>%
  filter(dep_delay >= 60) %>% 
  filter(dep_delay - arr_delay > 30)
```  

### Top 10 most departure delayed flights

```{r top 20 delays}
flights %>%
  arrange(desc(dep_delay)) %>%
  head(10)
```  

### Airport for the top 100 delayed flights

```{r airport for delayed flights}
flights %>%
  arrange(desc(dep_delay)) %>%
  head(100) %>%
  ggplot(aes(y = origin, fill = origin)) +
  geom_bar(show.legend = FALSE)
```  

### Shortest  flight

```{r shortest flight}
flights %>%
  arrange(distance) %>%
  head(1)
flights %>% 
  arrange(air_time) %>% 
  head(1)
```  

## Longest flight

```{r longest flight}
flights %>%
  arrange(desc(distance)) %>%
  head(1)
flights %>% 
  arrange(desc(air_time)) %>% 
  head(1)
```  